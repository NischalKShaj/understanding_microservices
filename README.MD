# Microservices-Based Authentication & File Upload System

## üìå Overview

This project follows a Microservices Architecture where authentication and file handling services are independent, loosely coupled, and communicate through an API Gateway.

### üìÇ Services in the Project

* API Gateway ‚Üí Centralized entry point for routing requests.
* Auth Service ‚Üí Handles user authentication (signup, login, JWT verification).
* File Service ‚Üí Manages file uploads, retrievals, and storage.

## üöÄ Project Setup

### 1Ô∏è‚É£ Clone the Repository

``` bash
 git clone http://192.168.2.81:3000/nischal/microservice_test_application.git
 cd microservice_test_application
```

### 2Ô∏è‚É£ Install Dependencies

Each service has its own dependencies. Navigate into each folder and install them:

```bash
cd api-gateway && npm install
cd ../auth-service && npm install
cd ../file-service && npm install
```

### 3Ô∏è‚É£ Set Up Environment Variables

Create a .env file in each service folder with the following variables:

API Gateway (.env)

```.env
# main frontend url
BASE_URL=http://localhost:5173

# auth server url
AUTH_URL=http://localhost:4001

# file server url
FILE_URL=http://localhost:4002

# Main port of the application
PORT=4000
```

Auth Service (.env)

```.env
# main frontend url
BASE_URL=http://localhost:5173

# Main Gateway URL
API_GATEWAY_URL=http://localhost:4000

# port for the auth service
PORT=4001

# for the database settings
AUTH_DB_USER=postgres
AUTH_DB_HOST=localhost
AUTH_DB_NAME=microservice_authentication
AUTH_DB_PASSWORD=admin
AUTH_DB_PORT=5432
```

File Service (.env)

```.env
# main frontend url
BASE_URL=http://localhost:5173

# Main Gateway URL
API_GATEWAY_URL=http://localhost:4000

# port for the file service
PORT=4002

# for the database settings
FILE_DB_USER=postgres
FILE_DB_HOST=localhost
FILE_DB_NAME=microservice_fileupload
FILE_DB_PASSWORD=admin
FILE_DB_PORT=5432
```

## üõ† Running the Services

Each service needs to be run separately:

### 1Ô∏è‚É£ Start API Gateway

```bash
cd api-gateway
npm run dev
```

### 2Ô∏è‚É£ Start Auth Service

```bash
cd auth-service
npm run dev
```

### 3Ô∏è‚É£ Start File Service

```bash
cd file-service
npm run dev
```

## üì° Inter-Service Communication

### Using Axios to Call Other Services via API Gateway

Auth Service fetches user-related files from File Service using the API Gateway:

```javascript
const axios = require("axios");
const dotenv = require("dotenv");
dotenv.config();

async uploadFiles(id, fileName, file_path) {
    try {
      console.log("api", process.env.API_GATEWAY_URL);
      let existUser = await axios.get(
        `${process.env.API_GATEWAY_URL}/auth/user/${id}`
      );
      console.log("exist user", existUser);
      if (!existUser.data) {
        return { success: false, data: "user not found" };
      }
      console.log("user data from the file repo", existUser.data);

      const uploading = await this.#fileRepository.uploadFiles(
        id,
        fileName,
        file_path
      );
      return { success: true, data: uploading };
    } catch (error) {
      console.error("error from here", error);
      return { success: false, data: error };
    }
  }
  ```

## üîí CORS Configuration

CORS should be configured in API Gateway to allow frontend access and communication between services.

### API Gateway (corsOptions.js)

```javascript
const dotenv = require("dotenv");
dotenv.config();

const corsOptions = {
  origin: [process.env.BASE_URL, process.env.AUTH_URL, process.env.FILE_URL],
  methods: ["GET", "POST", "PATCH", "PUT", "DELETE", "OPTIONS", "HEAD"],
  allowedHeaders: [
    "Origin",
    "X-Requested-With",
    "Content-Type",
    "Accept",
    "Authorization",
  ],
  credentials: true,
};

module.exports = corsOptions;
```

Each microservice should allow API Gateway‚Äôs requests.

## üìå API Endpoints

### Authentication Service (/auth)

```md
--------------------------------------------------------------
|Method |  End point | Description                                |
--------------------------------------------------------------
| POST     | /signup      | For user signup                        |
| POST     | /login         | For user login                          |
| GET       | /user/:id    | For getting a particular user   |
```

### File Service (/file)

```md
--------------------------------------------------------------
|Method |  End point | Description                                |
--------------------------------------------------------------
| POST     | /upload      | For uploading file                    |
```

## üõ† Tech Stack

* Backend: Node.js, Express.js

* Database: PostgreSQL

* Communication: Axios via API Gateway

* File Storage: Local storage (extendable to AWS S3, Cloudinary)

## üë®‚Äçüíª Contributors

[Nischal K Shaj](http://192.168.2.81:3000/nischal)
